<!--
   Copyright 2025 [Catalyst Curator LLC (catalystcurator-ops)]

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöí Firefighter Task Rescue</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        /* ==========================================
           NEW LOGIN SCREEN STYLES ONLY
           ========================================== */

        /* Animated Background for Login Screen */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(239, 68, 68, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(251, 146, 60, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(245, 158, 11, 0.08) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
            opacity: 0;
            transition: opacity 0.3s;
        }

        body.login-view::before {
            opacity: 1;
        }

        body.login-view {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-30px) scale(1.05); }
        }

        /* Particles Effect */
        .particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: rgba(251, 146, 60, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: particle-float 15s linear infinite;
            opacity: 0;
        }

        body.login-view .particle {
            opacity: 1;
        }

        @keyframes particle-float {
            0% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Modern Auth Container - Glassmorphism */
        #authContainer {
            max-width: 500px;
            margin: 80px auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(30px) saturate(180%);
            padding: 60px 50px;
            border-radius: 32px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset,
                0 0 100px rgba(251, 146, 60, 0.1);
            position: relative;
            z-index: 10;
            animation: slideIn 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            font-family: 'Poppins', sans-serif;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Decorative Glow */
        #authContainer::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, #ef4444, #f59e0b, #fb923c);
            border-radius: 32px;
            z-index: -1;
            opacity: 0.5;
            filter: blur(20px);
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }

        /* Fire Truck Animation */
        .auth-header {
            text-align: center;
            margin-bottom: 45px;
            position: relative;
        }

        .fire-truck-container {
            margin-bottom: 25px;
            position: relative;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .fire-truck-icon {
            font-size: 90px;
            display: inline-block;
            animation: truck-drive 3s ease-in-out infinite;
            filter: drop-shadow(0 15px 35px rgba(239, 68, 68, 0.4));
            position: relative;
            z-index: 2;
        }

        @keyframes truck-drive {
            0%, 100% { 
                transform: translateX(-15px) rotate(-3deg) scale(1); 
            }
            25% { 
                transform: translateX(-8px) rotate(-1deg) scale(1.02); 
            }
            50% { 
                transform: translateX(0px) rotate(0deg) scale(1.05); 
            }
            75% { 
                transform: translateX(8px) rotate(1deg) scale(1.02); 
            }
        }

        /* Smoke Effect */
        .smoke {
            position: absolute;
            bottom: 20px;
            left: 50%;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, rgba(148, 163, 184, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: smoke-float 2s ease-out infinite;
        }

        .smoke:nth-child(2) {
            animation-delay: 0.5s;
        }

        .smoke:nth-child(3) {
            animation-delay: 1s;
        }

        @keyframes smoke-float {
            0% {
                transform: translate(-50%, 0) scale(0.5);
                opacity: 0.6;
            }
            50% {
                opacity: 0.3;
            }
            100% {
                transform: translate(-50%, -50px) scale(1.5);
                opacity: 0;
            }
        }

        /* Shiny Premium Title with Dark Outline */
        #authContainer h1 {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(135deg, 
                #ef4444 0%, 
                #fb923c 25%, 
                #fbbf24 50%, 
                #fb923c 75%, 
                #ef4444 100%
            );
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -2px;
            animation: shine 4s linear infinite, float-title 3s ease-in-out infinite;
            position: relative;
            filter: drop-shadow(0 0 25px rgba(251, 146, 60, 0.5));
            -webkit-text-stroke: 2px rgba(0, 0, 0, 0.8);
            text-stroke: 2px rgba(0, 0, 0, 0.8);
            paint-order: stroke fill;
        }

        @keyframes shine {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        @keyframes float-title {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .auth-subtitle {
            font-size: 15px;
            color: #64748b;
            font-weight: 500;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .auth-tagline {
            font-size: 13px;
            color: #94a3b8;
            font-weight: 400;
            font-style: italic;
        }

        /* Premium Tab Design */
        .auth-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 35px;
            background: #f1f5f9;
            padding: 8px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05) inset;
        }

        .auth-tab {
            flex: 1;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            background: transparent;
            border: none;
            font-size: 15px;
            font-weight: 700;
            color: #64748b;
            border-radius: 14px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Poppins', sans-serif;
        }

        .auth-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ef4444, #fb923c);
            opacity: 0;
            transition: opacity 0.4s;
            z-index: -1;
        }

        .auth-tab.active {
            color: white;
            transform: scale(1.03);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }

        .auth-tab.active::before {
            opacity: 1;
        }

        .auth-tab:hover:not(.active) {
            background: #e2e8f0;
            transform: translateY(-3px);
        }

        /* Form Sections */
        .auth-form {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-form.active {
            display: block;
        }

        /* Modern Input Groups */
        .form-group {
            margin-bottom: 26px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #1e293b;
            font-weight: 600;
            font-size: 13px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            transition: all 0.3s;
            z-index: 2;
        }

        .form-group input {
            width: 100%;
            padding: 18px 20px 18px 52px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: #f8fafc;
            color: #1e293b;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ef4444;
            background: white;
            box-shadow: 
                0 0 0 4px rgba(239, 68, 68, 0.12),
                0 8px 24px rgba(239, 68, 68, 0.2);
            transform: translateY(-2px);
        }

        .form-group input:focus ~ .input-icon {
            color: #ef4444;
            transform: translateY(-50%) scale(1.1);
        }

        .form-group input::placeholder {
            color: #cbd5e1;
            font-weight: 400;
        }

        /* Password Strength Indicator */
        .password-strength {
            height: 5px;
            background: #e2e8f0;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }

        .password-strength.show {
            display: block;
        }

        .password-strength-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #22c55e);
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 10px;
        }

        /* Premium Gradient Button */
        .auth-button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #ef4444 0%, #fb923c 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 12px 35px rgba(239, 68, 68, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-family: 'Poppins', sans-serif;
        }

        .auth-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s;
        }

        .auth-button:hover::before {
            left: 100%;
        }

        .auth-button:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 18px 45px rgba(239, 68, 68, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.2) inset;
        }

        .auth-button:active {
            transform: translateY(-2px);
        }

        /* Alert Messages */
        .auth-error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            color: #dc2626;
            text-align: center;
            margin-top: 24px;
            font-size: 14px;
            font-weight: 600;
            padding: 16px;
            border-radius: 12px;
            border: 2px solid rgba(220, 38, 38, 0.2);
            animation: shake 0.6s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }

        .auth-success {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05));
            color: #16a34a;
            text-align: center;
            margin-top: 24px;
            font-size: 14px;
            font-weight: 600;
            padding: 16px;
            border-radius: 12px;
            border: 2px solid rgba(22, 163, 74, 0.2);
            animation: slideDown 0.6s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ==========================================
           ORIGINAL GAME DESIGN (UNCHANGED)
           ========================================== */

        /* Game Container */
        #gameContainer {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
        }

        #gameContainer.active {
            display: block;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 48px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .user-info {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 18px;
            opacity: 0.95;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat {
            background: rgba(255,255,255,0.95);
            padding: 15px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .controls {
            text-align: center;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 30px;
            margin: 0 10px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-reset {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-logout {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .houses-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding: 20px;
        }

        .house {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .house:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .house.burning {
            animation: shake-house 0.5s infinite;
        }

        @keyframes shake-house {
            0%, 100% { transform: translateX(0) translateY(-5px); }
            25% { transform: translateX(-5px) translateY(-5px); }
            75% { transform: translateX(5px) translateY(-5px); }
        }

        .category-badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .task-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .urgency-bar {
            height: 10px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .urgency-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #F44336);
            transition: width 1s linear;
            border-radius: 10px;
        }

        .timer {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .timer.warning {
            color: #FF9800;
            animation: pulse 1s infinite;
        }

        .timer.danger {
            color: #F44336;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .fire-effect {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 0;
            background: linear-gradient(0deg, #FF4500, #FFA500, transparent);
            transition: height 0.5s;
            pointer-events: none;
            opacity: 0.7;
        }

        .house.burning .fire-effect {
            height: 60%;
            animation: flicker 0.3s infinite;
        }

        @keyframes flicker {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 0.9; }
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-done {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-burn {
            background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
            color: white;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: fall 3s linear;
            pointer-events: none;
            z-index: 9999;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 14px;
            color: #666;
            display: none;
        }

        .sync-status.syncing {
            display: block;
            color: #667eea;
        }

        .sync-status.synced {
            display: block;
            color: #27ae60;
        }

        @media (max-width: 768px) {
            #authContainer {
                padding: 45px 30px;
                margin: 40px auto;
            }

            #authContainer h1 {
                font-size: 36px;
            }

            .fire-truck-icon {
                font-size: 70px;
            }

            h1 { font-size: 32px; }
            .houses-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .stats {
                gap: 15px;
            }
            .btn {
                padding: 10px 20px;
                font-size: 14px;
                margin: 5px;
            }
        }
    </style>
</head>
<body class="login-view">
    <!-- Floating Particles for Login -->
    <script>
        for (let i = 0; i < 15; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 15 + 's';
            particle.style.animationDuration = (10 + Math.random() * 10) + 's';
            document.body.appendChild(particle);
        }
    </script>

    <!-- Sync Status Indicator -->
    <div id="syncStatus" class="sync-status">üíæ Syncing...</div>

    <!-- Authentication Container -->
    <div id="authContainer">
        <div class="auth-header">
            <div class="fire-truck-container">
                <div class="smoke"></div>
                <div class="smoke"></div>
                <div class="smoke"></div>
                <div class="fire-truck-icon">üöí</div>
            </div>
            <h1>Task Rescue</h1>
            <p class="auth-subtitle">Firefighter Mission Control</p>
            <p class="auth-tagline">Save your tasks from burning down</p>
        </div>
        
        <div class="auth-tabs">
            <button class="auth-tab active" data-tab="login">Login</button>
            <button class="auth-tab" data-tab="signup">Sign Up</button>
        </div>

        <!-- Login Form -->
        <div id="loginForm" class="auth-form active">
            <div class="form-group">
                <label for="loginEmail">Email Address</label>
                <div class="input-wrapper">
                    <input type="email" id="loginEmail" placeholder="your@email.com" required>
                    <div class="input-icon">üìß</div>
                </div>
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <div class="input-wrapper">
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    <div class="input-icon">üîí</div>
                </div>
            </div>
            <button class="auth-button" onclick="handleLogin()">üöí Start Mission</button>
        </div>

        <!-- Sign Up Form -->
        <div id="signupForm" class="auth-form">
            <div class="form-group">
                <label for="signupEmail">Email Address</label>
                <div class="input-wrapper">
                    <input type="email" id="signupEmail" placeholder="your@email.com" required>
                    <div class="input-icon">üìß</div>
                </div>
            </div>
            <div class="form-group">
                <label for="signupPassword">Password</label>
                <div class="input-wrapper">
                    <input type="password" id="signupPassword" placeholder="Minimum 6 characters" required oninput="checkPasswordStrength(this.value)">
                    <div class="input-icon">üîí</div>
                </div>
                <div class="password-strength" id="passwordStrength">
                    <div class="password-strength-fill" id="passwordStrengthFill"></div>
                </div>
            </div>
            <div class="form-group">
                <label for="signupPasswordConfirm">Confirm Password</label>
                <div class="input-wrapper">
                    <input type="password" id="signupPasswordConfirm" placeholder="Re-enter password" required>
                    <div class="input-icon">‚úÖ</div>
                </div>
            </div>
            <button class="auth-button" onclick="handleSignup()">üî• Join the Team</button>
        </div>

        <div id="authMessage"></div>
    </div>

    <!-- Game Container - YOUR ORIGINAL DESIGN -->
    <div id="gameContainer">
        <header>
            <h1>üöí Firefighter Task Rescue</h1>
            <div class="user-info" id="userInfo">
                <span id="userEmail"></span>
            </div>
            <p class="tagline">Save your tasks from burning down!</p>
        </header>

        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="completedCount">0</div>
                <div class="stat-label">üöí Tasks Saved</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="burnedCount">0</div>
                <div class="stat-label">üî• Houses Burned</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="activeCount">7</div>
                <div class="stat-label">üè† Active Tasks</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-reset" onclick="mentalHealthReset()">üïäÔ∏è Let It Burn (Mental Health Reset)</button>
            <button class="btn btn-logout" onclick="handleLogout()">üö™ Logout</button>
        </div>

        <div class="houses-container" id="housesContainer"></div>
    </div>

    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // SUPABASE CONFIGURATION
        const SUPABASE_URL = 'https://jytolrylfsgcibwtklrp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp5dG9scnlsZnNnY2lid3RrbHJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjU3MjEsImV4cCI6MjA3ODY0MTcyMX0.q22DexG-cm5erVJpfY0SeRLfWN3PWRLuLUhqUn3mXOk';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let currentUser = null;

        // Tab switching
        document.querySelectorAll('.auth-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                document.getElementById(tabName + 'Form').classList.add('active');
                
                showAuthMessage('', false);
            });
        });

        // Handle Enter key
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const form = e.target.closest('.auth-form');
                    if (form.id === 'loginForm') handleLogin();
                    else if (form.id === 'signupForm') handleSignup();
                }
            });
        });

        // Password strength checker
        function checkPasswordStrength(password) {
            const strengthBar = document.getElementById('passwordStrength');
            const strengthFill = document.getElementById('passwordStrengthFill');
            
            if (password.length === 0) {
                strengthBar.classList.remove('show');
                return;
            }
            
            strengthBar.classList.add('show');
            let strength = 0;
            
            if (password.length >= 6) strength += 33;
            if (password.length >= 10) strength += 33;
            if (/[A-Z]/.test(password) && /[a-z]/.test(password)) strength += 17;
            if (/[0-9]/.test(password)) strength += 17;
            
            strengthFill.style.width = strength + '%';
        }

        async function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showAuthMessage('Please fill in all fields', false);
                return;
            }

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });

                if (error) throw error;

                currentUser = data.user;
                showGame();
                await loadUserTasks();
            } catch (error) {
                showAuthMessage(error.message, false);
            }
        }

        async function handleSignup() {
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupPasswordConfirm').value;

            if (!email || !password || !confirmPassword) {
                showAuthMessage('Please fill in all fields', false);
                return;
            }

            if (password.length < 6) {
                showAuthMessage('Password must be at least 6 characters', false);
                return;
            }

            if (password !== confirmPassword) {
                showAuthMessage('Passwords do not match', false);
                return;
            }

            try {
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password
                });

                if (error) throw error;

                showAuthMessage('‚úÖ Account created! Please check your email to verify.', true);
                
                setTimeout(() => {
                    document.querySelector('[data-tab="login"]').click();
                    document.getElementById('loginEmail').value = email;
                }, 2000);
            } catch (error) {
                showAuthMessage(error.message, false);
            }
        }

        async function handleLogout() {
            if (confirm('Are you sure you want to logout? Your tasks are saved in the cloud.')) {
                await saveTasksToCloud();
                await supabase.auth.signOut();
                currentUser = null;
                showAuth();
            }
        }

        function showAuthMessage(message, isSuccess) {
            const messageEl = document.getElementById('authMessage');
            messageEl.textContent = message;
            messageEl.className = isSuccess ? 'auth-success' : 'auth-error';
        }

        function showAuth() {
            document.body.classList.add('login-view');
            document.getElementById('authContainer').style.display = 'block';
            document.getElementById('gameContainer').classList.remove('active');
        }

        function showGame() {
            document.body.classList.remove('login-view');
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('gameContainer').classList.add('active');
            document.getElementById('userEmail').textContent = currentUser.email;
        }

        supabase.auth.onAuthStateChange((event, session) => {
            if (session) {
                currentUser = session.user;
                showGame();
                loadUserTasks();
            } else {
                showAuth();
            }
        });

        // CLOUD SYNC
        function showSyncStatus(status) {
            const syncEl = document.getElementById('syncStatus');
            syncEl.className = 'sync-status ' + status;
            
            if (status === 'syncing') {
                syncEl.textContent = 'üíæ Syncing...';
            } else if (status === 'synced') {
                syncEl.textContent = '‚úÖ Synced';
                setTimeout(() => {
                    syncEl.className = 'sync-status';
                }, 2000);
            }
        }

        async function saveTasksToCloud() {
            if (!currentUser) return;
            
            showSyncStatus('syncing');
            
            const tasksData = {
                tasks: tasks,
                stats: {
                    completed: completedTasks,
                    burned: burnedTasks
                }
            };

            try {
                const { data: existing } = await supabase
                    .from('user_tasks')
                    .select('id')
                    .eq('user_id', currentUser.id)
                    .single();

                if (existing) {
                    await supabase
                        .from('user_tasks')
                        .update({ tasks: tasksData })
                        .eq('user_id', currentUser.id);
                } else {
                    await supabase
                        .from('user_tasks')
                        .insert([{ 
                            user_id: currentUser.id, 
                            tasks: tasksData 
                        }]);
                }
                
                showSyncStatus('synced');
            } catch (error) {
                console.error('Error saving tasks:', error);
            }
        }

        async function loadUserTasks() {
            if (!currentUser) return;
            
            try {
                const { data, error } = await supabase
                    .from('user_tasks')
                    .select('tasks')
                    .eq('user_id', currentUser.id)
                    .single();

                if (data && data.tasks) {
                    tasks = data.tasks.tasks || [];
                    completedTasks = data.tasks.stats?.completed || 0;
                    burnedTasks = data.tasks.stats?.burned || 0;
                    
                    updateStats();
                    renderHouses();
                } else {
                    init();
                }
            } catch (error) {
                init();
            }
        }

        setInterval(() => {
            if (currentUser) {
                saveTasksToCloud();
            }
        }, 30000);

        // GAME LOGIC - YOUR ORIGINAL CODE
        const taskPool = [
            { category: 'Work', emoji: 'üíº', title: 'Reply to emails', description: 'Clear out that inbox before it explodes!', color: '#3498db' },
            { category: 'Work', emoji: 'üíº', title: 'Finish project report', description: 'Get those TPS reports done!', color: '#3498db' },
            { category: 'Work', emoji: 'üíº', title: 'Schedule team meeting', description: 'Coordinate with the crew', color: '#3498db' },
            { category: 'Work', emoji: 'üíº', title: 'Update LinkedIn profile', description: 'Professional presence matters', color: '#3498db' },
            { category: 'Work', emoji: 'üíº', title: 'Review code PR', description: 'Help your teammate ship that feature', color: '#3498db' },
            { category: 'Health', emoji: 'üèÉ', title: 'Go for a 20-min walk', description: 'Your body will thank you!', color: '#27ae60' },
            { category: 'Health', emoji: 'üèÉ', title: 'Drink 8 glasses of water', description: 'Hydration = life', color: '#27ae60' },
            { category: 'Health', emoji: 'üèÉ', title: 'Do 10 pushups', description: 'Quick strength boost!', color: '#27ae60' },
            { category: 'Health', emoji: 'üèÉ', title: 'Schedule doctor appointment', description: 'That checkup is overdue', color: '#27ae60' },
            { category: 'Health', emoji: 'üèÉ', title: 'Meditate for 5 minutes', description: 'Mental health counts too', color: '#27ae60' },
            { category: 'Finance', emoji: 'üí∞', title: 'Pay credit card bill', description: 'Avoid those late fees!', color: '#f39c12' },
            { category: 'Finance', emoji: 'üí∞', title: 'Review budget', description: 'Where did your money go?', color: '#f39c12' },
            { category: 'Finance', emoji: 'üí∞', title: 'Set up auto-pay', description: 'Automate your finances', color: '#f39c12' },
            { category: 'Finance', emoji: 'üí∞', title: 'Transfer to savings', description: 'Future you will be grateful', color: '#f39c12' },
            { category: 'Finance', emoji: 'üí∞', title: 'Review subscriptions', description: 'Cancel what you don\'t use', color: '#f39c12' },
            { category: 'Social', emoji: 'üë•', title: 'Text that friend', description: 'They miss you!', color: '#e74c3c' },
            { category: 'Social', emoji: 'üë•', title: 'Plan weekend hangout', description: 'Social life needs attention', color: '#e74c3c' },
            { category: 'Social', emoji: 'üë•', title: 'Reply to group chat', description: 'Don\'t be that person', color: '#e74c3c' },
            { category: 'Social', emoji: 'üë•', title: 'Call your parents', description: 'They want to hear from you', color: '#e74c3c' },
            { category: 'Social', emoji: 'üë•', title: 'Send birthday wishes', description: 'Someone\'s special day!', color: '#e74c3c' },
            { category: 'Family', emoji: 'üë®‚Äçüë©‚Äçüëß', title: 'Family dinner tonight', description: 'Quality time together', color: '#9b59b6' },
            { category: 'Family', emoji: 'üë®‚Äçüë©‚Äçüëß', title: 'Help kids with homework', description: 'Support their learning', color: '#9b59b6' },
            { category: 'Family', emoji: 'üë®‚Äçüë©‚Äçüëß', title: 'Plan family activity', description: 'Create memories!', color: '#9b59b6' },
            { category: 'Family', emoji: 'üë®‚Äçüë©‚Äçüëß', title: 'Video call grandparents', description: 'They love seeing you', color: '#9b59b6' },
            { category: 'Family', emoji: 'üë®‚Äçüë©‚Äçüëß', title: 'Update family calendar', description: 'Keep everyone coordinated', color: '#9b59b6' },
            { category: 'Personal', emoji: 'üå±', title: 'Read for 15 minutes', description: 'Feed your mind', color: '#1abc9c' },
            { category: 'Personal', emoji: 'üå±', title: 'Learn something new', description: 'Growth happens daily', color: '#1abc9c' },
            { category: 'Personal', emoji: 'üå±', title: 'Journal your thoughts', description: 'Reflect on your day', color: '#1abc9c' },
            { category: 'Personal', emoji: 'üå±', title: 'Practice a new skill', description: 'Get 1% better', color: '#1abc9c' },
            { category: 'Personal', emoji: 'üå±', title: 'Set weekly goals', description: 'Direction creates progress', color: '#1abc9c' },
            { category: 'Home', emoji: 'üè°', title: 'Do the dishes', description: 'Clean kitchen = clear mind', color: '#e67e22' },
            { category: 'Home', emoji: 'üè°', title: 'Take out trash', description: 'Before it starts smelling!', color: '#e67e22' },
            { category: 'Home', emoji: 'üè°', title: 'Vacuum living room', description: 'Dust bunnies must go', color: '#e67e22' },
            { category: 'Home', emoji: 'üè°', title: 'Water the plants', description: 'They need love too!', color: '#e67e22' },
            { category: 'Home', emoji: 'üè°', title: 'Organize one drawer', description: 'Small wins count', color: '#e67e22' }
        ];

        let tasks = [];
        let completedTasks = 0;
        let burnedTasks = 0;

        function init() {
            tasks = [];
            for (let i = 0; i < 7; i++) {
                const randomTask = taskPool[Math.floor(Math.random() * taskPool.length)];
                createHouse({ ...randomTask });
            }
            updateStats();
            renderHouses();
        }

        function createHouse(taskData) {
            const house = {
                id: Date.now() + Math.random(),
                ...taskData,
                timeLeft: 60,
                burning: false,
                gracePeriod: false
            };
            tasks.push(house);
            startTimer(house.id);
            return house;
        }

        function startTimer(houseId) {
            const interval = setInterval(() => {
                const house = tasks.find(h => h.id === houseId);
                if (!house) {
                    clearInterval(interval);
                    return;
                }

                house.timeLeft--;

                if (house.timeLeft <= 0 && !house.gracePeriod) {
                    house.burning = true;
                    house.gracePeriod = true;
                    house.timeLeft = 10;
                }

                if (house.timeLeft <= 0 && house.gracePeriod) {
                    burnHouse(houseId);
                    clearInterval(interval);
                    return;
                }

                renderHouses();
            }, 1000);
        }

        function completeTask(houseId) {
            tasks = tasks.filter(h => h.id !== houseId);
            completedTasks++;
            updateStats();
            renderHouses();
            createConfetti();
            
            const randomTask = taskPool[Math.floor(Math.random() * taskPool.length)];
            createHouse({ ...randomTask });
            renderHouses();
            
            saveTasksToCloud();
        }

        function burnHouse(houseId) {
            tasks = tasks.filter(h => h.id !== houseId);
            burnedTasks++;
            updateStats();
            renderHouses();
            
            const randomTask = taskPool[Math.floor(Math.random() * taskPool.length)];
            createHouse({ ...randomTask });
            renderHouses();
            
            saveTasksToCloud();
        }

        function mentalHealthReset() {
            if (confirm('üïäÔ∏è Let it all burn and start fresh? This is your mental health reset.')) {
                tasks = [];
                renderHouses();
                
                setTimeout(() => {
                    for (let i = 0; i < 7; i++) {
                        setTimeout(() => {
                            const randomTask = taskPool[Math.floor(Math.random() * taskPool.length)];
                            createHouse({ ...randomTask });
                            renderHouses();
                        }, i * 300);
                    }
                    saveTasksToCloud();
                }, 500);
            }
        }

        function updateStats() {
            document.getElementById('completedCount').textContent = completedTasks;
            document.getElementById('burnedCount').textContent = burnedTasks;
            document.getElementById('activeCount').textContent = tasks.length;
        }

        function renderHouses() {
            const container = document.getElementById('housesContainer');
            container.innerHTML = '';

            tasks.forEach(house => {
                const houseEl = document.createElement('div');
                houseEl.className = 'house' + (house.burning ? ' burning' : '');
                
                const urgencyPercent = house.gracePeriod ? 100 : ((60 - house.timeLeft) / 60) * 100;
                const minutes = Math.floor(house.timeLeft / 60);
                const seconds = house.timeLeft % 60;
                const timeDisplay = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                let timerClass = 'timer';
                if (house.gracePeriod) {
                    timerClass += ' danger';
                } else if (house.timeLeft <= 20) {
                    timerClass += ' warning';
                }

                houseEl.innerHTML = `
                    <span class="category-badge" style="background: ${house.color}; color: white;">
                        ${house.emoji} ${house.category}
                    </span>
                    <div class="task-title">${house.title}</div>
                    <div class="task-description">${house.description}</div>
                    <div class="urgency-bar">
                        <div class="urgency-fill" style="width: ${urgencyPercent}%"></div>
                    </div>
                    <div class="${timerClass}">
                        ${house.gracePeriod ? 'üî• ' : '‚è±Ô∏è '}${timeDisplay}
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn btn-done" onclick="completeTask(${house.id})">
                            ‚úÖ Done
                        </button>
                        <button class="action-btn btn-burn" onclick="burnHouse(${house.id})">
                            üî• Burn
                        </button>
                    </div>
                    <div class="fire-effect"></div>
                `;
                
                container.appendChild(houseEl);
            });
        }

        function createConfetti() {
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '0px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 1) + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }
    </script>
</body>
</html>
